<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahmad Hisham - لوحة التحكم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #7f8c8d;
            --warning: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--dark) 0%, #1a2530 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }
        
        .logo i {
            margin-left: 10px;
            color: var(--secondary);
        }
        
        .auth-buttons button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            transition: background 0.3s;
        }
        
        .auth-buttons button:hover {
            background: #c0392b;
        }
        
        /* Admin Panel */
        .admin-panel {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin: 2rem 0;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-tab {
            padding: 12px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .admin-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        
        .admin-content {
            display: none;
        }
        
        .admin-content.active {
            display: block;
        }
        
        .admin-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .admin-games-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .admin-game-card {
            background: #f9f9f9;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .admin-game-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .admin-game-info {
            padding: 15px;
        }
        
        .admin-game-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .btn-edit {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-delete {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .stat-card p {
            color: var(--gray);
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            color: white;
            padding: 2rem 0 1rem;
            margin-top: 4rem;
        }
        
        .copyright {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* إضافة أنماط جديدة لتحميل الصور المتعددة */
        .multi-image-upload {
            margin-bottom: 20px;
        }
        
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-preview-item .remove-image {
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--accent);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .admin-form {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .auth-buttons {
                margin-top: 15px;
            }
            
            .admin-tabs {
                flex-wrap: wrap;
            }
            
            .admin-tab {
                margin-bottom: 5px;
            }
        }
        
        @media (max-width: 576px) {
            .admin-games-list {
                grid-template-columns: 1fr;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <span>Ahmad Hisham</span>
                <i class="fas fa-gamepad"></i>
                <span style="margin-right: 15px; font-size: 1.2rem;">لوحة التحكم</span>
            </div>
            
            <div class="auth-buttons">
                <button id="backToStore">العودة للمتجر</button>
                <button id="logoutBtn">تسجيل الخروج</button>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- إحصائيات -->
        <div class="stats-cards">
            <div class="stat-card">
                <i class="fas fa-gamepad"></i>
                <h3 id="totalGames">0</h3>
                <p>إجمالي الألعاب</p>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-tags"></i>
                <h3 id="totalCategories">0</h3>
                <p>عدد الفئات</p>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-percentage"></i>
                <h3 id="discountGames">0</h3>
                <p>ألعاب عليها خصم</p>
            </div>
            
            <div class="stat-card">
                <i class="fas fa-shopping-cart"></i>
                <h3 id="totalOrders">0</h3>
                <p>الطلبات اليوم</p>
            </div>
        </div>
        
        <!-- لوحة التحكم -->
        <div class="admin-panel">
            <div class="admin-header">
                <h2>إدارة المتجر</h2>
                <p>مرحباً، Admin</p>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="add-game">إضافة لعبة</div>
                <div class="admin-tab" data-tab="manage-games">إدارة الألعاب</div>
                <div class="admin-tab" data-tab="discounts">إدارة التخفيضات</div>
                <div class="admin-tab" data-tab="orders">الطلبات</div>
            </div>
            
            <div class="admin-content active" id="add-game">
                <form class="admin-form" id="addGameForm">
                    <div class="form-group">
                        <label for="gameTitle">اسم اللعبة</label>
                        <input type="text" id="gameTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gamePrice">السعر (L.E)</label>
                        <input type="number" id="gamePrice" required min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="gameCategory">الفئة</label>
                        <select id="gameCategory">
                            <option value="action">أكشن</option>
                            <option value="adventure">مغامرة</option>
                            <option value="sports">رياضة</option>
                            <option value="strategy">إستراتيجية</option>
                            <option value="rpg">ألعاب أدوار</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="gameDiscount">نسبة الخصم (%)</label>
                        <input type="number" id="gameDiscount" min="0" max="100" value="0">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="gameDescription">وصف اللعبة</label>
                        <textarea id="gameDescription"></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>صورة اللعبة الرئيسية</label>
                        <div class="image-preview" id="imagePreview">
                            <span>معاينة الصورة</span>
                        </div>
                        <input type="file" id="gameImage" accept="image/*">
                    </div>
                    
                    <div class="form-group full-width">
                        <label>صور اللعبة الإضافية (يمكن اختيار أكثر من صورة)</label>
                        <input type="file" id="multiGameImages" accept="image/*" multiple>
                        <div class="image-preview-container" id="multiImagePreview">
                            <!-- معاينة الصور المتعددة ستظهر هنا -->
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="gameVideo">رابط فيديو اللعبة (YouTube)</label>
                        <input type="url" id="gameVideo" placeholder="https://www.youtube.com/embed/...">
                    </div>
                    
                    <div class="form-group full-width">
                        <button type="submit" class="btn">إضافة اللعبة</button>
                    </div>
                </form>
            </div>
            
            <div class="admin-content" id="manage-games">
                <h3>الألعاب المضافة</h3>
                <div class="admin-games-list" id="adminGamesList">
                    <!-- Admin games will be added here -->
                </div>
            </div>
            
            <div class="admin-content" id="discounts">
                <h3>إدارة التخفيضات</h3>
                <p>هنا يمكنك إدارة التخفيضات والعروض الخاصة على الألعاب</p>
                <!-- Discount management interface will be added here -->
            </div>
            
            <div class="admin-content" id="orders">
                <h3>الطلبات</h3>
                <p>هنا يمكنك عرض وإدارة طلبات العملاء</p>
                <!-- Orders management interface will be added here -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="copyright">
                <p>© 2023 Ahmad Hisham. جميع الحقوق محفوظة</p>
            </div>
        </div>
    </footer>

    <script>
        // بيانات التطبيق
        let games = JSON.parse(localStorage.getItem('games')) || [];
        
        // عناصر DOM
        const addGameForm = document.getElementById('addGameForm');
        const adminTabs = document.querySelectorAll('.admin-tab');
        const adminContents = document.querySelectorAll('.admin-content');
        const adminGamesList = document.getElementById('adminGamesList');
        const imagePreview = document.getElementById('imagePreview');
        const gameImageInput = document.getElementById('gameImage');
        const multiGameImagesInput = document.getElementById('multiGameImages');
        const multiImagePreview = document.getElementById('multiImagePreview');
        const logoutBtn = document.getElementById('logoutBtn');
        const backToStore = document.getElementById('backToStore');
        const totalGames = document.getElementById('totalGames');
        const totalCategories = document.getElementById('totalCategories');
        const discountGames = document.getElementById('discountGames');
        const totalOrders = document.getElementById('totalOrders');

        // التحقق من تسجيل الدخول
        function checkLogin() {
            const isLoggedIn = sessionStorage.getItem('isAdminLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                window.location.href = 'index.html';
            }
        }

        // تهيئة الصفحة
        function init() {
            checkLogin();
            updateStats();
            displayAdminGames();
            
            // معاينة الصورة الرئيسية قبل الرفع
            if (gameImageInput) {
                gameImageInput.addEventListener('change', function() {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imagePreview.innerHTML = `<img src="${e.target.result}" alt="معاينة الصورة">`;
                        }
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // تهيئة تحميل الصور المتعددة
            if (multiGameImagesInput) {
                multiGameImagesInput.addEventListener('change', function() {
                    const files = this.files;
                    
                    if (files && files.length > 0) {
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            if (file.type.match('image.*')) {
                                const reader = new FileReader();
                                reader.onload = function(e) {
                                    const previewItem = document.createElement('div');
                                    previewItem.className = 'image-preview-item';
                                    previewItem.innerHTML = `
                                        <img src="${e.target.result}" alt="معاينة الصورة">
                                        <button type="button" class="remove-image">&times;</button>
                                    `;
                                    multiImagePreview.appendChild(previewItem);
                                    
                                    // إضافة event listener لزر الإزالة
                                    previewItem.querySelector('.remove-image').addEventListener('click', function() {
                                        previewItem.remove();
                                    });
                                }
                                reader.readAsDataURL(file);
                            }
                        }
                    }
                });
            }
        }

        // تحديث الإحصائيات
        function updateStats() {
            totalGames.textContent = games.length;
            
            // حساب عدد الفئات الفريدة
            const categories = [...new Set(games.map(game => game.category))];
            totalCategories.textContent = categories.length;
            
            // حساب عدد الألعاب التي عليها خصم
            const discountCount = games.filter(game => game.discount > 0).length;
            discountGames.textContent = discountCount;
            
            // عدد الطلبات (بيانات وهمية)
            totalOrders.textContent = Math.floor(Math.random() * 20) + 5;
        }

        // عرض الألعاب في لوحة التحكم
        function displayAdminGames() {
            adminGamesList.innerHTML = '';
            
            if (games.length === 0) {
                adminGamesList.innerHTML = '<p>لا توجد ألعاب مضافة بعد.</p>';
                return;
            }
            
            games.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'admin-game-card';
                gameCard.innerHTML = `
                    <img src="${game.image}" alt="${game.title}" class="admin-game-image">
                    <div class="admin-game-info">
                        <h4>${game.title}</h4>
                        <p>السعر: ${game.price} L.E</p>
                        <p>الخصم: ${game.discount}%</p>
                        <p>الفئة: ${getCategoryName(game.category)}</p>
                        <p>عدد الصور: ${game.images ? game.images.length : 1}</p>
                        ${game.video ? '<p>يحتوي على فيديو</p>' : ''}
                        <div class="admin-game-actions">
                            <button class="btn-edit" data-id="${game.id}">تعديل</button>
                            <button class="btn-delete" data-id="${game.id}">حذف</button>
                        </div>
                    </div>
                `;
                adminGamesList.appendChild(gameCard);
            });
            
            // إضافة event listeners لأزرار الحذف
            document.querySelectorAll('.btn-delete').forEach(button => {
                button.addEventListener('click', (e) => {
                    const gameId = parseInt(e.target.getAttribute('data-id'));
                    deleteGame(gameId);
                });
            });
        }

        // الحصول على اسم الفئة
        function getCategoryName(category) {
            const categories = {
                'action': 'أكشن',
                'adventure': 'مغامرة',
                'sports': 'رياضة',
                'strategy': 'إستراتيجية',
                'rpg': 'ألعاب أدوار'
            };
            
            return categories[category] || category;
        }

        // إضافة لعبة جديدة
        function addGame(title, price, category, discount, description, image, additionalImages, video) {
            const newId = games.length > 0 ? Math.max(...games.map(g => g.id)) + 1 : 1;
            
            // إذا لم يتم تحميل أي صور إضافية، استخدم الصورة الرئيسية فقط
            const allImages = additionalImages && additionalImages.length > 0 
                ? additionalImages 
                : [image || "https://images.unsplash.com/photo-1542751371-adc38448a05e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"];
            
            const newGame = {
                id: newId,
                title,
                price: parseFloat(price),
                category,
                discount: parseInt(discount),
                description,
                image: image || allImages[0], // الصورة الأولى كصورة رئيسية
                images: allImages, // جميع الصور
                video: video || "" // رابط الفيديو (إن وجد)
            };
            
            games.push(newGame);
            localStorage.setItem('games', JSON.stringify(games));
            displayAdminGames();
            updateStats();
            
            // إعادة تعيين النموذج
            addGameForm.reset();
            imagePreview.innerHTML = '<span>معاينة الصورة</span>';
            multiImagePreview.innerHTML = '';
            
            alert('تم إضافة اللعبة بنجاح!');
        }

        // حذف لعبة
        function deleteGame(gameId) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذه اللعبة؟')) {
                games = games.filter(game => game.id !== gameId);
                localStorage.setItem('games', JSON.stringify(games));
                displayAdminGames();
                updateStats();
                alert('تم حذف اللعبة بنجاح!');
            }
        }

        // تسجيل الخروج
        function logout() {
            sessionStorage.removeItem('isAdminLoggedIn');
            window.location.href = 'index.html';
        }

        // event listeners
        addGameForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('gameTitle').value;
            const price = document.getElementById('gamePrice').value;
            const category = document.getElementById('gameCategory').value;
            const discount = document.getElementById('gameDiscount').value;
            const description = document.getElementById('gameDescription').value;
            const video = document.getElementById('gameVideo').value;
            
            // الحصول على الصورة الرئيسية
            let mainImage = null;
            if (gameImageInput.files && gameImageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    mainImage = e.target.result;
                    
                    // الحصول على الصور الإضافية
                    let additionalImages = [];
                    const additionalImageElements = multiImagePreview.querySelectorAll('img');
                    
                    if (additionalImageElements.length > 0) {
                        additionalImages = Array.from(additionalImageElements).map(img => img.src);
                        addGame(title, price, category, discount, description, mainImage, additionalImages, video);
                    } else {
                        // إذا لم توجد صور إضافية، استدعاء الدالة مباشرة
                        addGame(title, price, category, discount, description, mainImage, [], video);
                    }
                }
                reader.readAsDataURL(gameImageInput.files[0]);
            } else {
                // إذا لم يتم تحميل صورة رئيسية، استدعاء الدالة بدون صور
                let additionalImages = [];
                const additionalImageElements = multiImagePreview.querySelectorAll('img');
                
                if (additionalImageElements.length > 0) {
                    additionalImages = Array.from(additionalImageElements).map(img => img.src);
                }
                
                addGame(title, price, category, discount, description, null, additionalImages, video);
            }
        });

        // تبديل علامات التبويب في لوحة التحكم
        adminTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // إزالة النشاط من جميع علامات التبويب والمحتويات
                adminTabs.forEach(t => t.classList.remove('active'));
                adminContents.forEach(c => c.classList.remove('active'));
                
                // إضافة النشاط إلى علامة التبويب والمحتوى المحددين
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        logoutBtn.addEventListener('click', logout);
        
        backToStore.addEventListener('click', () => {
            window.location.href = 'index.html';
        });

        // تهيئة الصفحة
        init();
    </script>
</body>
</html>